## sed工作模式

sed(Stream Editor)，流编辑器。对标准输出或文件逐行进行处理

### 语法格式

+ 第一种形式：`stdout | sed [option] "pattern command"`
+ 第二种形式：`sed [option] "pattern command" file`

## sed的选项

| 选项 | 含义                               |
| ---- | ---------------------------------- |
| -n   | 只打印模式匹配行                   |
| -e   | 直接在命令行进行sed编辑，默认选项  |
| -f   | 编辑动作保存在文件中，指定文件执行 |
| -r   | 支持扩展正则表达式                 |
| -i   | 直接修改文件内容                   |

+ sed在处理文件内容的时候，会把原内容打印一遍，`-n`命令会取消原内容的输出
+ 如果需要加多个匹配规则，则需要使用`-e`命令，例如：`sed -n -e '/python/p' -e '/PYTHON/p' sed.txt`
+ 命令保存在文件中，`-f`后面跟上这个保存命令的文件，这样也可以执行，例如：`sed -n -f edit.sed sed.txt`
+ `-i`直接修改原文件的内容，一般情况下不会对原文件内容做修改

```shell
#将文件中的love替换为like，并不会修改原文件的内容
sed -n 's/love/like/g;p' sed.txt
#替换内容，并且修改原文件中的内容
sed -i 's/love/like/g;p' sed.txt
```

## sed中的pattern详解

### 用法表

| 匹配模式                     | 含义                                             |
| ---------------------------- | ------------------------------------------------ |
| 10command                    | 匹配到第10行                                     |
| 10,20command                 | 匹配从第10行开始，到第20行结束                   |
| 10,+5command                 | 匹配从第10行开始，到第16行结束                   |
| /pattern1/command            | 匹配到pattern1的行                               |
| /pattern1/,/pattern2/command | 匹配到pattern1的行开始，到匹配到pattern2的行结束 |
| 10,/pattern1/command         | 匹配从第10行开始，到匹配到pettern1的行结束       |
| /pattern1/,10command         | 匹配到pattern1的行开始，到第10行匹配结束         |

```shell
#打印file文件的第17行
sed -n "17p" file
#打印file文件的10-20行
sed -n "10,20p" file
```

## sed中的编辑命令详解

| 类别 | 编辑命令       | 含义                                    |
| ---- | -------------- | --------------------------------------- |
| 插叙 | p              | 打印                                    |
| 增加 | a              | 行后追加                                |
|      | i              | 行前追加                                |
|      | r              | 外部文件读入，行后追加                  |
|      | w              | 匹配行写入外部文件                      |
| 删除 | d              | 删除                                    |
| 修改 | `s/old/new`    | 将行内第一个old替换为new                |
|      | `s/old/new/n`  | 将行内第n个old替换为new                 |
|      | `s/old/new/g`  | 将行内全部的old替换为new                |
|      | `s/old/new/2g` | 将行内从第2个开始以后的old全部替换为new |
|      | `s/old/new/ig` | 将行内old全部替换为new，忽略大小写      |

```shell
#行前追加
sed -i '/^love/,/^you/i what?' test.txt
#外部文件读入，行后追加
sed -i '/^love/r list' test.txt
#使用=，显示行号
sed '/dog/=' test.txt
#使用&引用前面匹配到的整个字符串,在匹配字符串的后面添加一个字母s
sed '/dog/&s/g' test.txt
#使用\1引用前面匹配到的字符串,\1只代替括号里面的
sed '/\(dog\)/\1s/g' test.txt
#删除配置文件中所有注释行和空行
sed -i '/[:black:]*#/d;/^$/d' nginx.conf
#在配置文件中所有不以#开头的行前面添加*符号，注意：以#号开头的行不添加
sed -i 's/^[^#]/\*&/g' nginx.conf
```

### 反向引用

+ `&`和`\1`，都可以用作引用模式
+ 两者区别在于&只能表示匹配到的完整字符串，只能引用整个字符串；`\1`可以使用`()`对匹配到的字符串

### 注意事项

	+ 匹配模式中存在变量，则建议使用双引号
	+ sed中需要引入自定义变量时，如果外面使用单引号，则自定义变量也必须使用单引号



## 

 